var W=Object.create;var E=Object.defineProperty;var F=Object.getOwnPropertyDescriptor;var z=Object.getOwnPropertyNames;var D=Object.getPrototypeOf,N=Object.prototype.hasOwnProperty;var K=(n,i)=>()=>(i||n((i={exports:{}}).exports,i),i.exports);var J=(n,i,u,x)=>{if(i&&typeof i=="object"||typeof i=="function")for(let f of z(i))!N.call(n,f)&&f!==u&&E(n,f,{get:()=>i[f],enumerable:!(x=F(i,f))||x.enumerable});return n};var H=(n,i,u)=>(u=n!=null?W(D(n)):{},J(i||!n||!n.__esModule?E(u,"default",{value:n,enumerable:!0}):u,n));var q=K((Pt,k)=>{var $=function(){var n=String.fromCharCode,i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",u="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",x={};function f(t,s){if(!x[t]){x[t]={};for(var p=0;p<t.length;p++)x[t][t.charAt(p)]=p}return x[t][s]}var g={compressToBase64:function(t){if(t==null)return"";var s=g._compress(t,6,function(p){return i.charAt(p)});switch(s.length%4){default:case 0:return s;case 1:return s+"===";case 2:return s+"==";case 3:return s+"="}},decompressFromBase64:function(t){return t==null?"":t==""?null:g._decompress(t.length,32,function(s){return f(i,t.charAt(s))})},compressToUTF16:function(t){return t==null?"":g._compress(t,15,function(s){return n(s+32)})+" "},decompressFromUTF16:function(t){return t==null?"":t==""?null:g._decompress(t.length,16384,function(s){return t.charCodeAt(s)-32})},compressToUint8Array:function(t){for(var s=g.compress(t),p=new Uint8Array(s.length*2),o=0,a=s.length;o<a;o++){var h=s.charCodeAt(o);p[o*2]=h>>>8,p[o*2+1]=h%256}return p},decompressFromUint8Array:function(t){if(t==null)return g.decompress(t);for(var s=new Array(t.length/2),p=0,o=s.length;p<o;p++)s[p]=t[p*2]*256+t[p*2+1];var a=[];return s.forEach(function(h){a.push(n(h))}),g.decompress(a.join(""))},compressToEncodedURIComponent:function(t){return t==null?"":g._compress(t,6,function(s){return u.charAt(s)})},decompressFromEncodedURIComponent:function(t){return t==null?"":t==""?null:(t=t.replace(/ /g,"+"),g._decompress(t.length,32,function(s){return f(u,t.charAt(s))}))},compress:function(t){return g._compress(t,16,function(s){return n(s)})},_compress:function(t,s,p){if(t==null)return"";var o,a,h={},b={},w="",j="",m="",y=2,U=3,l=2,d=[],e=0,r=0,v;for(v=0;v<t.length;v+=1)if(w=t.charAt(v),Object.prototype.hasOwnProperty.call(h,w)||(h[w]=U++,b[w]=!0),j=m+w,Object.prototype.hasOwnProperty.call(h,j))m=j;else{if(Object.prototype.hasOwnProperty.call(b,m)){if(m.charCodeAt(0)<256){for(o=0;o<l;o++)e=e<<1,r==s-1?(r=0,d.push(p(e)),e=0):r++;for(a=m.charCodeAt(0),o=0;o<8;o++)e=e<<1|a&1,r==s-1?(r=0,d.push(p(e)),e=0):r++,a=a>>1}else{for(a=1,o=0;o<l;o++)e=e<<1|a,r==s-1?(r=0,d.push(p(e)),e=0):r++,a=0;for(a=m.charCodeAt(0),o=0;o<16;o++)e=e<<1|a&1,r==s-1?(r=0,d.push(p(e)),e=0):r++,a=a>>1}y--,y==0&&(y=Math.pow(2,l),l++),delete b[m]}else for(a=h[m],o=0;o<l;o++)e=e<<1|a&1,r==s-1?(r=0,d.push(p(e)),e=0):r++,a=a>>1;y--,y==0&&(y=Math.pow(2,l),l++),h[j]=U++,m=String(w)}if(m!==""){if(Object.prototype.hasOwnProperty.call(b,m)){if(m.charCodeAt(0)<256){for(o=0;o<l;o++)e=e<<1,r==s-1?(r=0,d.push(p(e)),e=0):r++;for(a=m.charCodeAt(0),o=0;o<8;o++)e=e<<1|a&1,r==s-1?(r=0,d.push(p(e)),e=0):r++,a=a>>1}else{for(a=1,o=0;o<l;o++)e=e<<1|a,r==s-1?(r=0,d.push(p(e)),e=0):r++,a=0;for(a=m.charCodeAt(0),o=0;o<16;o++)e=e<<1|a&1,r==s-1?(r=0,d.push(p(e)),e=0):r++,a=a>>1}y--,y==0&&(y=Math.pow(2,l),l++),delete b[m]}else for(a=h[m],o=0;o<l;o++)e=e<<1|a&1,r==s-1?(r=0,d.push(p(e)),e=0):r++,a=a>>1;y--,y==0&&(y=Math.pow(2,l),l++)}for(a=2,o=0;o<l;o++)e=e<<1|a&1,r==s-1?(r=0,d.push(p(e)),e=0):r++,a=a>>1;for(;;)if(e=e<<1,r==s-1){d.push(p(e));break}else r++;return d.join("")},decompress:function(t){return t==null?"":t==""?null:g._decompress(t.length,32768,function(s){return t.charCodeAt(s)})},_decompress:function(t,s,p){var o=[],a,h=4,b=4,w=3,j="",m=[],y,U,l,d,e,r,v,c={val:p(0),position:s,index:1};for(y=0;y<3;y+=1)o[y]=y;for(l=0,e=Math.pow(2,2),r=1;r!=e;)d=c.val&c.position,c.position>>=1,c.position==0&&(c.position=s,c.val=p(c.index++)),l|=(d>0?1:0)*r,r<<=1;switch(a=l){case 0:for(l=0,e=Math.pow(2,8),r=1;r!=e;)d=c.val&c.position,c.position>>=1,c.position==0&&(c.position=s,c.val=p(c.index++)),l|=(d>0?1:0)*r,r<<=1;v=n(l);break;case 1:for(l=0,e=Math.pow(2,16),r=1;r!=e;)d=c.val&c.position,c.position>>=1,c.position==0&&(c.position=s,c.val=p(c.index++)),l|=(d>0?1:0)*r,r<<=1;v=n(l);break;case 2:return""}for(o[3]=v,U=v,m.push(v);;){if(c.index>t)return"";for(l=0,e=Math.pow(2,w),r=1;r!=e;)d=c.val&c.position,c.position>>=1,c.position==0&&(c.position=s,c.val=p(c.index++)),l|=(d>0?1:0)*r,r<<=1;switch(v=l){case 0:for(l=0,e=Math.pow(2,8),r=1;r!=e;)d=c.val&c.position,c.position>>=1,c.position==0&&(c.position=s,c.val=p(c.index++)),l|=(d>0?1:0)*r,r<<=1;o[b++]=n(l),v=b-1,h--;break;case 1:for(l=0,e=Math.pow(2,16),r=1;r!=e;)d=c.val&c.position,c.position>>=1,c.position==0&&(c.position=s,c.val=p(c.index++)),l|=(d>0?1:0)*r,r<<=1;o[b++]=n(l),v=b-1,h--;break;case 2:return m.join("")}if(h==0&&(h=Math.pow(2,w),w++),o[v])j=o[v];else if(v===b)j=U+U.charAt(0);else return null;m.push(j),o[b++]=U+j.charAt(0),h--,U=j,h==0&&(h=Math.pow(2,w),w++)}}};return g}();typeof define=="function"&&define.amd?define(function(){return $}):typeof k<"u"&&k!=null&&(k.exports=$)});var Z=n=>!n?.startsWith("http")&&!n?.startsWith("data:"),P=(n,i=document.baseURI)=>Z(n)?new URL(n,i).href:n;var A=(n,i)=>new Promise((u,x)=>{if(i&&window[i])return u(window[i]);let f=document.createElement("script");f.src=n,f.async=!0;let g=()=>{f.removeEventListener("load",t),f.removeEventListener("error",s)},t=()=>{if(g(),!i)return u("loaded: "+n);let p=setInterval(()=>{if(window[i])return clearInterval(p),u(window[i])},5)},s=()=>{g(),x("failed to load: "+n)};f.addEventListener("load",t),f.addEventListener("error",s),document.head.appendChild(f)});var T="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js",_="https://cdn.rescript-lang.org/v9.1.2/compiler.js",M="https://cdn.rescript-lang.org/v9.1.2/%40rescript/react/cmij.js",R="https://cdn.jsdelivr.net/npm/@rescript/std@9.1.3/lib/es6/";var S=(n=location.origin)=>Boolean(n&&(n.endsWith("livecodes.io")||n.endsWith("livecodes.pages.dev")||n.endsWith("localpen.io")||n.endsWith("localpen.pages.dev")||n.startsWith("http://127.0.0.1")||n.startsWith("http://localhost")));var C=H(q());var L="https://dpaste.com/",V="https://dpaste.com/api/v2/",O="https://api2.livecodes.io/share",B={getProject:async n=>{try{let i=await fetch(L+n+".txt");return i.ok?JSON.parse(await i.text()):{}}catch{return{}}},shareProject:async n=>{try{let i=await fetch(V,{method:"POST",mode:"cors",headers:{"Content-Type":"application/x-www-form-urlencoded","User-Agent":"LiveCodes / https://livecodes.io/"},body:`content=${encodeURIComponent(JSON.stringify(n))}&title=${encodeURIComponent(n.title||"")}&syntax=json&expiry_days=365`});return i.ok?(await i.text()).replace(L,""):""}catch{return""}}},X={getProject:async n=>{if(n.length<11)return B.getProject(n);if(!S())return{};try{let i=await fetch(O+"?id="+n);return i.ok?JSON.parse(await i.text()):{}}catch{return{}}},shareProject:async n=>{if(!S())return"";try{let i=await fetch(O,{method:"POST",mode:"cors",body:JSON.stringify(n)});return i.ok?i.text():""}catch{return""}}},oe=S()?X:B;var I=/(import\s+?(?:(?:(?:[\w*\s{},\$]*)\s+from\s+?)|))((?:".*?")|(?:'.*?'))([\s]*?(?:;|$|))/g;var Y=(n,i)=>n.replace(new RegExp(I),u=>u.replace(new RegExp(I),"$2").replace(/"/g,"").replace(/'/g,"").startsWith("./stdlib/")?u.replace("./stdlib/",i):u),Ce=async(n,{baseUrl:i,language:u})=>new Promise(async(x,f)=>{if(!n)return x("");window.require||await A(T,"require"),window.require([_,M],()=>{let g=window.rescript_compiler.make();g.setModuleSystem("es6"),g.setFilename("index.bs.js");let t=g[u].compile(n);try{return t.type==="success"&&t.js_code?x(Y(t.js_code,P(R,i))):(t.errors?t.errors.forEach(s=>{console.error(s.fullMsg)}):t.msg&&console.warn(t.msg,t.type),f(""))}catch(s){return console.error(s),f("")}})});export{Ce as rescriptCompiler};
//# sourceMappingURL=lang-rescript-compiler-esm.js.map

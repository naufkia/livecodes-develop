"use strict";var H=Object.defineProperty;var F=Object.getOwnPropertyDescriptor;var Q=Object.getOwnPropertyNames;var $=Object.prototype.hasOwnProperty;var D=(s,n)=>{for(var d in n)H(s,d,{get:n[d],enumerable:!0})},B=(s,n,d,c)=>{if(n&&typeof n=="object"||typeof n=="function")for(let a of Q(n))!$.call(s,a)&&a!==d&&H(s,a,{get:()=>n[a],enumerable:!(c=F(n,a))||c.enumerable});return s};var G=s=>B(H({},"__esModule",{value:!0}),s);var K={};D(K,{createPlayground:()=>N});module.exports=G(K);var N=async(s,n={})=>{let{appUrl:d="https://livecodes.io/",params:c={},config:a={},import:v,lite:z=!1,loading:L="lazy",template:M,view:W="split"}=n,r;if(typeof s=="string"?r=document.querySelector(s):r=s,!s)throw new Error("Container element is required.");if(!r)throw new Error(`Cannot find element: "${s}"`);let l;try{l=new URL(d)}catch(e){throw new Error(`"${d}" is not a valid URL.`)}let p=l.origin;if(typeof c=="object"&&Object.keys(c).forEach(e=>{l.searchParams.set(e,String(c[e]))}),typeof a=="string")l.searchParams.set("config",a);else if(typeof a=="object"&&Object.keys(a).length>0)try{let e=btoa(JSON.stringify(a));l.searchParams.set("config","data:application/json;base64,"+e)}catch(e){throw new Error("Invalid configuration object.")}M&&l.searchParams.set("template",M),v&&l.searchParams.set("x",v),l.searchParams.set(z?"lite":"embed","true"),l.searchParams.set("loading",L),l.searchParams.set("view",W);let b=!1,u=!1,E="Cannot call API methods after calling `destroy()`.",C=await(()=>new Promise(e=>{var y,P,f,w,g,T,O,R,U;if(!r)return;let o=r.dataset.height||r.style.height;if(o){let x=isNaN(Number(o))?o:o+"px";r.style.height=x}r.dataset.defaultStyles!=="false"&&((y=r.style).backgroundColor||(y.backgroundColor="#fff"),(P=r.style).border||(P.border="1px solid black"),(f=r.style).borderRadius||(f.borderRadius="5px"),(w=r.style).boxSizing||(w.boxSizing="border-box"),(g=r.style).padding||(g.padding="0"),(T=r.style).width||(T.width="100%"),(O=r.style).height||(O.height=r.style.height||"300px"),r.style.minHeight="200px",(R=r.style).overflow||(R.overflow="hidden"),(U=r.style).resize||(U.resize="vertical"));let t=document.createElement("iframe");t.setAttribute("allow","accelerometer; camera; encrypted-media; display-capture; geolocation; gyroscope; microphone; midi; clipboard-read; clipboard-write; web-share"),t.setAttribute("allowtransparency","true"),t.setAttribute("allowpaymentrequest","true"),t.setAttribute("allowfullscreen","true"),t.setAttribute("sandbox","allow-same-origin allow-downloads allow-forms allow-modals allow-orientation-lock allow-pointer-lock allow-popups allow-presentation allow-scripts");let m=L==="eager"?"eager":"lazy";t.setAttribute("loading",m),t.classList.add("livecodes"),t.style.height="100%",t.style.minHeight="200px",t.style.width="100%",t.style.margin="0",t.style.border="0",t.style.borderRadius=r.style.borderRadius,t.src=l.href,t.onload=()=>{addEventListener("message",function x(A){var j;A.source!==t.contentWindow||A.origin!==p||((j=A.data)==null?void 0:j.type)==="livecodes-ready"&&(removeEventListener("message",x),b=!0)}),e(t)},r.innerHTML="",r.appendChild(t)}))(),q=(e=100)=>new Promise(o=>{setTimeout(o,e)}),I=()=>u?Promise.reject(E):new Promise(async e=>{var t;let o={type:"livecodes-load"};for((t=C.contentWindow)==null||t.postMessage(o,p);!b;)await q();e()}),i=(e,o)=>new Promise(async(t,m)=>{var y;if(u)return m(E);b||await I(),addEventListener("message",function P(f){var w;if(!(f.source!==C.contentWindow||f.origin!==p||((w=f.data)==null?void 0:w.type)!=="livecodes-api-response")&&f.data.method===e){removeEventListener("message",P);let g=f.data.payload;g!=null&&g.error?m(g.error):t(g)}}),(y=C.contentWindow)==null||y.postMessage({method:e,args:o},p)}),h=[],J=e=>{if(u)throw new Error(E);return h.push(e),{remove:()=>{h=h.filter(o=>o!==e)}}};addEventListener("message",async e=>{var m;if(e.source!==C.contentWindow||e.origin!==p||((m=e.data)==null?void 0:m.type)!=="livecodes-change")return;let o=await i("getCode"),t=await i("getConfig");h.forEach(y=>{y({code:o,config:t})})});let S=()=>{h.length=0,r&&(r.innerHTML=""),u=!0};return L==="lazy"&&"IntersectionObserver"in window&&new IntersectionObserver((o,t)=>{o.forEach(async m=>{m.isIntersecting&&(await I(),t.unobserve(r))})},{rootMargin:"150px"}).observe(r),{load:()=>I(),run:()=>i("run"),format:e=>i("format",[e]),getShareUrl:e=>i("getShareUrl",[e]),getConfig:e=>i("getConfig",[e]),setConfig:e=>i("setConfig",[e]),getCode:()=>i("getCode"),show:(e,o)=>i("show",[e,o]),runTests:()=>i("runTests"),onChange:e=>J(e),exec:(e,...o)=>i("exec",[e,...o]),destroy:()=>b?i("destroy").then(S):u?Promise.reject(E):(S(),Promise.resolve())}},k;globalThis.document&&document.currentScript&&"prefill"in((k=document.currentScript)==null?void 0:k.dataset)&&window.addEventListener("load",()=>{document.querySelectorAll(".livecodes").forEach(s=>{let n,d=s.dataset.options;if(d)try{n=JSON.parse(d)}catch(v){}let c,a=s.dataset.config||s.dataset.prefill;if(a)try{c=JSON.parse(a)}catch(v){}N(s,{import:"dom/"+encodeURIComponent(s.outerHTML),...n,...c?{config:c}:{}})})});
//# sourceMappingURL=livecodes.cjs.map

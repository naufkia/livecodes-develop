import J,{useEffect as D,useRef as F}from"react";var R=async(s,u={})=>{let{appUrl:g="https://livecodes.io/",params:l={},config:a={},import:p,lite:h=!1,loading:c="lazy",template:w,view:z="split"}=u,r;if(typeof s=="string"?r=document.querySelector(s):r=s,!s)throw new Error("Container element is required.");if(!r)throw new Error(`Cannot find element: "${s}"`);let i;try{i=new URL(g)}catch(e){throw new Error(`"${g}" is not a valid URL.`)}let v=i.origin;if(typeof l=="object"&&Object.keys(l).forEach(e=>{i.searchParams.set(e,String(l[e]))}),typeof a=="string")i.searchParams.set("config",a);else if(typeof a=="object"&&Object.keys(a).length>0)try{let e=btoa(JSON.stringify(a));i.searchParams.set("config","data:application/json;base64,"+e)}catch(e){throw new Error("Invalid configuration object.")}w&&i.searchParams.set("template",w),p&&i.searchParams.set("x",p),i.searchParams.set(h?"lite":"embed","true"),i.searchParams.set("loading",c),i.searchParams.set("view",z);let C=!1,b=!1,L="Cannot call API methods after calling `destroy()`.",x=await(()=>new Promise(e=>{var y,I,f,P,m,T,O,N,U;if(!r)return;let o=r.dataset.height||r.style.height;if(o){let M=isNaN(Number(o))?o:o+"px";r.style.height=M}r.dataset.defaultStyles!=="false"&&((y=r.style).backgroundColor||(y.backgroundColor="#fff"),(I=r.style).border||(I.border="1px solid black"),(f=r.style).borderRadius||(f.borderRadius="5px"),(P=r.style).boxSizing||(P.boxSizing="border-box"),(m=r.style).padding||(m.padding="0"),(T=r.style).width||(T.width="100%"),(O=r.style).height||(O.height=r.style.height||"300px"),r.style.minHeight="200px",(N=r.style).overflow||(N.overflow="hidden"),(U=r.style).resize||(U.resize="vertical"));let t=document.createElement("iframe");t.setAttribute("allow","accelerometer; camera; encrypted-media; display-capture; geolocation; gyroscope; microphone; midi; clipboard-read; clipboard-write; web-share"),t.setAttribute("allowtransparency","true"),t.setAttribute("allowpaymentrequest","true"),t.setAttribute("allowfullscreen","true"),t.setAttribute("sandbox","allow-same-origin allow-downloads allow-forms allow-modals allow-orientation-lock allow-pointer-lock allow-popups allow-presentation allow-scripts");let d=c==="eager"?"eager":"lazy";t.setAttribute("loading",d),t.classList.add("livecodes"),t.style.height="100%",t.style.minHeight="200px",t.style.width="100%",t.style.margin="0",t.style.border="0",t.style.borderRadius=r.style.borderRadius,t.src=i.href,t.onload=()=>{addEventListener("message",function M(A){var k;A.source!==t.contentWindow||A.origin!==v||((k=A.data)==null?void 0:k.type)==="livecodes-ready"&&(removeEventListener("message",M),C=!0)}),e(t)},r.innerHTML="",r.appendChild(t)}))(),W=(e=100)=>new Promise(o=>{setTimeout(o,e)}),H=()=>b?Promise.reject(L):new Promise(async e=>{var t;let o={type:"livecodes-load"};for((t=x.contentWindow)==null||t.postMessage(o,v);!C;)await W();e()}),n=(e,o)=>new Promise(async(t,d)=>{var y;if(b)return d(L);C||await H(),addEventListener("message",function I(f){var P;if(!(f.source!==x.contentWindow||f.origin!==v||((P=f.data)==null?void 0:P.type)!=="livecodes-api-response")&&f.data.method===e){removeEventListener("message",I);let m=f.data.payload;m!=null&&m.error?d(m.error):t(m)}}),(y=x.contentWindow)==null||y.postMessage({method:e,args:o},v)}),E=[],q=e=>{if(b)throw new Error(L);return E.push(e),{remove:()=>{E=E.filter(o=>o!==e)}}};addEventListener("message",async e=>{var d;if(e.source!==x.contentWindow||e.origin!==v||((d=e.data)==null?void 0:d.type)!=="livecodes-change")return;let o=await n("getCode"),t=await n("getConfig");E.forEach(y=>{y({code:o,config:t})})});let S=()=>{E.length=0,r&&(r.innerHTML=""),b=!0};return c==="lazy"&&"IntersectionObserver"in window&&new IntersectionObserver((o,t)=>{o.forEach(async d=>{d.isIntersecting&&(await H(),t.unobserve(r))})},{rootMargin:"150px"}).observe(r),{load:()=>H(),run:()=>n("run"),format:e=>n("format",[e]),getShareUrl:e=>n("getShareUrl",[e]),getConfig:e=>n("getConfig",[e]),setConfig:e=>n("setConfig",[e]),getCode:()=>n("getCode"),show:(e,o)=>n("show",[e,o]),runTests:()=>n("runTests"),onChange:e=>q(e),exec:(e,...o)=>n("exec",[e,...o]),destroy:()=>C?n("destroy").then(S):b?Promise.reject(L):(S(),Promise.resolve())}},j;globalThis.document&&document.currentScript&&"prefill"in((j=document.currentScript)==null?void 0:j.dataset)&&window.addEventListener("load",()=>{document.querySelectorAll(".livecodes").forEach(s=>{let u,g=s.dataset.options;if(g)try{u=JSON.parse(g)}catch(p){}let l,a=s.dataset.config||s.dataset.prefill;if(a)try{l=JSON.parse(a)}catch(p){}R(s,{import:"dom/"+encodeURIComponent(s.outerHTML),...u,...l?{config:l}:{}})})});function Q(s){let{className:u,style:g,height:l,sdkReady:a,...p}=s,h=F(null),c;return D(()=>{if(h.current)return R(h.current,p).then(w=>{c=w,typeof a=="function"&&a(w)}),()=>{c==null||c.destroy()}},[]),J.createElement("div",{ref:h,className:u,style:g,"data-height":l})}export{Q as default};
//# sourceMappingURL=react.js.map

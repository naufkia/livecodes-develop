var q=async(n,w={})=>{let{appUrl:g="https://livecodes.io/",params:m={},config:l={},import:v,lite:k=!1,loading:L="lazy",template:H,view:N="split"}=w,r;if(typeof n=="string"?r=document.querySelector(n):r=n,!n)throw new Error("Container element is required.");if(!r)throw new Error(`Cannot find element: "${n}"`);let a;try{a=new URL(g)}catch(e){throw new Error(`"${g}" is not a valid URL.`)}let y=a.origin;if(typeof m=="object"&&Object.keys(m).forEach(e=>{a.searchParams.set(e,String(m[e]))}),typeof l=="string")a.searchParams.set("config",l);else if(typeof l=="object"&&Object.keys(l).length>0)try{let e=btoa(JSON.stringify(l));a.searchParams.set("config","data:application/json;base64,"+e)}catch(e){throw new Error("Invalid configuration object.")}H&&a.searchParams.set("template",H),v&&a.searchParams.set("x",v),a.searchParams.set(k?"lite":"embed","true"),a.searchParams.set("loading",L),a.searchParams.set("view",N);let b=!1,p=!1,E="Cannot call API methods after calling `destroy()`.",C=await(()=>new Promise(e=>{var f,P,d,h,c,S,T,O,R;if(!r)return;let o=r.dataset.height||r.style.height;if(o){let x=isNaN(Number(o))?o:o+"px";r.style.height=x}r.dataset.defaultStyles!=="false"&&((f=r.style).backgroundColor||(f.backgroundColor="#fff"),(P=r.style).border||(P.border="1px solid black"),(d=r.style).borderRadius||(d.borderRadius="5px"),(h=r.style).boxSizing||(h.boxSizing="border-box"),(c=r.style).padding||(c.padding="0"),(S=r.style).width||(S.width="100%"),(T=r.style).height||(T.height=r.style.height||"300px"),r.style.minHeight="200px",(O=r.style).overflow||(O.overflow="hidden"),(R=r.style).resize||(R.resize="vertical"));let t=document.createElement("iframe");t.setAttribute("allow","accelerometer; camera; encrypted-media; display-capture; geolocation; gyroscope; microphone; midi; clipboard-read; clipboard-write; web-share"),t.setAttribute("allowtransparency","true"),t.setAttribute("allowpaymentrequest","true"),t.setAttribute("allowfullscreen","true"),t.setAttribute("sandbox","allow-same-origin allow-downloads allow-forms allow-modals allow-orientation-lock allow-pointer-lock allow-popups allow-presentation allow-scripts");let i=L==="eager"?"eager":"lazy";t.setAttribute("loading",i),t.classList.add("livecodes"),t.style.height="100%",t.style.minHeight="200px",t.style.width="100%",t.style.margin="0",t.style.border="0",t.style.borderRadius=r.style.borderRadius,t.src=a.href,t.onload=()=>{addEventListener("message",function x(A){var U;A.source!==t.contentWindow||A.origin!==y||((U=A.data)==null?void 0:U.type)==="livecodes-ready"&&(removeEventListener("message",x),b=!0)}),e(t)},r.innerHTML="",r.appendChild(t)}))(),z=(e=100)=>new Promise(o=>{setTimeout(o,e)}),I=()=>p?Promise.reject(E):new Promise(async e=>{var t;let o={type:"livecodes-load"};for((t=C.contentWindow)==null||t.postMessage(o,y);!b;)await z();e()}),s=(e,o)=>new Promise(async(t,i)=>{var f;if(p)return i(E);b||await I(),addEventListener("message",function P(d){var h;if(!(d.source!==C.contentWindow||d.origin!==y||((h=d.data)==null?void 0:h.type)!=="livecodes-api-response")&&d.data.method===e){removeEventListener("message",P);let c=d.data.payload;c!=null&&c.error?i(c.error):t(c)}}),(f=C.contentWindow)==null||f.postMessage({method:e,args:o},y)}),u=[],W=e=>{if(p)throw new Error(E);return u.push(e),{remove:()=>{u=u.filter(o=>o!==e)}}};addEventListener("message",async e=>{var i;if(e.source!==C.contentWindow||e.origin!==y||((i=e.data)==null?void 0:i.type)!=="livecodes-change")return;let o=await s("getCode"),t=await s("getConfig");u.forEach(f=>{f({code:o,config:t})})});let M=()=>{u.length=0,r&&(r.innerHTML=""),p=!0};return L==="lazy"&&"IntersectionObserver"in window&&new IntersectionObserver((o,t)=>{o.forEach(async i=>{i.isIntersecting&&(await I(),t.unobserve(r))})},{rootMargin:"150px"}).observe(r),{load:()=>I(),run:()=>s("run"),format:e=>s("format",[e]),getShareUrl:e=>s("getShareUrl",[e]),getConfig:e=>s("getConfig",[e]),setConfig:e=>s("setConfig",[e]),getCode:()=>s("getCode"),show:(e,o)=>s("show",[e,o]),runTests:()=>s("runTests"),onChange:e=>W(e),exec:(e,...o)=>s("exec",[e,...o]),destroy:()=>b?s("destroy").then(M):p?Promise.reject(E):(M(),Promise.resolve())}},j;globalThis.document&&document.currentScript&&"prefill"in((j=document.currentScript)==null?void 0:j.dataset)&&window.addEventListener("load",()=>{document.querySelectorAll(".livecodes").forEach(n=>{let w,g=n.dataset.options;if(g)try{w=JSON.parse(g)}catch(v){}let m,l=n.dataset.config||n.dataset.prefill;if(l)try{m=JSON.parse(l)}catch(v){}q(n,{import:"dom/"+encodeURIComponent(n.outerHTML),...w,...m?{config:m}:{}})})});export{q as createPlayground};
//# sourceMappingURL=livecodes.js.map
